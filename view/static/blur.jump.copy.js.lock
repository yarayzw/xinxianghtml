const href=window.location.href;
$(function () {
    const html2=$('#html2').html();
    //控制显示
    if (!new RegExp('(.*?)\\#$').test(href)) {//显示列表
        $('html').html(html2);
    }
    if (!new RegExp('(.*?)\\#$').test(href)&&href.indexOf('?_v=2')<0) {
        $('html').css({height:'100%',overflow:'hidden'});
    }else if (href.indexOf('#')>-1){
        $('html').removeAttr('style');
    }else{
        window.setTimeout(function () {
            var fix = $("#rightFix");
            var _fix = $("#fix");
            var top = fix.position().top;
            $(window).on('scroll', function () {
                var scrollTop = $(window).scrollTop();
                if (scrollTop >= top) {
                    fix.css({ position: 'fixed', top: 0 })
                } else {
                    fix.css({ position: 'static' })
                }
            });
        });
    }
    if (href.indexOf('#')>-1){
        $('#main .blur0').attr('href', href + '#');
    } else {
        $('#main .blur0').attr("href",href.split('?')[0]+'#');
    }
    $('html').show();//显示html
});
$(function () {
    //判断是否是允许的域名
    const allowDomainStr=(typeof allowDomains!='undefined'&&allowDomains)?allowDomains:'';

    var allowDomainStrDecode;
    try {//解密
        allowDomainStrDecode=(window.atob(window.atob(allowDomainStr).split("").reverse().join("")))
    }catch (e) {}
    const allowDomainList=allowDomainStrDecode!=''?allowDomainStrDecode.split(','):["@abn&dsn&sadfcs"];
    allowDomainList.push("http://temp.jindouyun.com/");
    var allVisit=false;//允许访问
    allowDomainList.forEach(function (val) {
        if (href.indexOf(val)>-1) {
            allVisit=true;
        }
    });
    if (!allVisit){
        $('*').html('<h3 style="text-align: center;color: #8e8b8b;">非法访问:(</h3>');
        return false;
    }
    //关闭页面标志
    const CLOSE_FLAG='closed_flag';
    const SAW_FLAG='saw_flag';
    if (!new RegExp('(.*?)\\#$').test(href)) {
        //设置模糊
        if (href.indexOf('?_v=2')<0) {

            /*$('#main>:not(.blur0)').css('filter','blur(20px)');
            $('#body>:not(#header,#main,#ex)').css('filter','blur(20px)');
            $('a:not(.blur0)').attr('onclick','return false;');*/
            //$('#main>:not(.blur0)').css('display','none');
            /*$('#main>:not(.blur0)').css('opacity','0.03');
            $('#body>:not(#header,#main,#ex)').css('opacity','0.03');*/
            $('#main>:not(.blur0)').css('opacity','0.2');//其他透明
            $('.blur0').next('a').css('opacity','1');//提示不透明
            $('#main>#main-other').css('position','relative').prepend('<div style="position:absolute;width:100%;height:100%;background:black;opacity:0.8;z-index:99999;"></div>')
            $('a:not(.blur0)').attr('onclick','return false;');
            $('#rightFix').css('opacity','0.2').css('position','relative').prepend('<div style="position:absolute;width:100%;height:100%;background:black;opacity:0.8;z-index:99999;"></div>');
        }else {

            $('#main .blur0 img').attr('src','/static/img/zjnx.jpg');
            $('#main .blur0 p').text('儿子去世，托梦给母亲说在水里难受，隔天母亲抽干池塘，瘫坐在地！');
            $('#main .blur0').attr('href','/static/list/zjnx.html#');
        }
        setTimeout(function () {
            window.scrollTo(0,0);//回到顶部
        },200);
        localStorage.setItem(CLOSE_FLAG,0);
        localStorage.setItem(SAW_FLAG,0);
        window.setInterval(function () {
            var closeFlag=localStorage.getItem(CLOSE_FLAG);
            var sawFlag=localStorage.getItem(SAW_FLAG);
            if (closeFlag==null&&sawFlag==0) {
                if (href.indexOf('?_v=2')<0){
                    window.location.href=href.split('?')[0]+'?_v=2';
                }
            }
            if (closeFlag==null&&sawFlag==1){
                if (href.indexOf('?_v=1')<0){
                    window.location.href=href.split('?')[0]+'?_v=1';
                }
            }
        },1000);
    }else {
        document.addEventListener('scroll',function(){//监听页面滑动
            //浏览器高
            var innerHeight=window.innerHeight;
            var scrollTop=$(document).scrollTop();
            var offsetTop=$('#qr_code_bottom').offset().top;
            if (offsetTop<scrollTop+innerHeight){
                localStorage.setItem(SAW_FLAG,1);
            }
        });
    }
    //禁止复制、右键、键盘
    /*document.oncontextmenu=new Function('event.returnValue=false;');
    document.onselectstart=new Function('event.returnValue=false;');
    document.onkeydown=new Function('event.returnValue=false;');*/
    //监听页面关闭
    window.onunload = function(){
        localStorage.removeItem(CLOSE_FLAG);
    };
});