<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>筋斗云管理系统</title>
    <link href="../css/bootstrap.min14ed.css?v=3.3.6" rel="stylesheet">
    <link href="../css/font-awesome.min93e3.css?v=4.4.0" rel="stylesheet">
    <link href="../css/animate.min.css" rel="stylesheet">
    <link href="../css/style.min862f.css?v=4.1.0" rel="stylesheet">
    <link href="../css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
    <link href="../css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../js/simditor-2.3.28/styles/simditor.css">
    <link rel="stylesheet" type="text/css" href="../css/plugins/webuploader/webuploader.css">
    <link rel="stylesheet" type="text/css" href="../css/demo/webuploader-demo.min.css">

    <!--    下来框样式-->
    <link rel="stylesheet" type="text/css" href="../js/plugins/bootstrap-select-1.13.9/dist/css/bootstrap-select.css">

<body>
<div id="tj_div" style="margin: 20px 12%;width: 75%">
    <div style="text-align: center;height: 40px;line-height: 40px;font-size: 18px;margin-bottom: 10px;background: #2E91DA;color: white" id="title">

    </div>
    <div style="float: left;width: 60%">
        <div style="float: left;width: 34%;height:320px;text-align: center;border-right: #ccc solid 1px">
            <div style="text-align: center">
                <strong style="font-size: 14px">最近1分钟</strong>
                <br>
                <span style="font-size: 12px;line-height: 50px;">
                    您网站上有 <span style="color: red; font-size: 40px" id="all_num">0</span> 独立访客
                </span>
                <div style="font-size: 12px; background: #f9d59e;width: 100%;height: 26px;line-height: 26px;text-align: center">
                    今日最高： <span id="today_max">0</span> <span style="color: #999; padding: 0px 10px;">|</span> 发生在
                    <span id="today_max_time">0</span>
                </div>
            </div>
            <br>
            <div >
                <div style="float: left; line-height: 26px; font-weight:bold;  width: 49%;text-align: left;padding-left:1%;">
                    <strong style="font-size: 12px">今日汇总</strong>
                    <br>
                    <span style="font-size: 14px; color: #2e91da">浏览次数: <span style="font-size: 20px"
                                                                              id="all_all">0</span></span><br>
                    <span style="font-size: 14px; color: #FF9900">独立访客: <span style="font-size: 20px"
                                                                              id="all_fk">0</span></span><br>
                    <span style="font-size: 14px; color: #6cbf3d">独立IP数: <span style="font-size: 20px"
                                                                               id="all_ip">0</span></span>
                </div>
                <div style="float: left; line-height: 26px; font-weight:bold; width: 49%;text-align: left;padding-left:1%;">
                    <strong style="font-size: 12px">最近15分钟</strong>
                    <br>
                    <span style="font-size: 14px; color: #2e91da">浏览次数: <span style="font-size: 20px"
                                                                              id="15_all">0</span></span><br>
                    <span style="font-size: 14px; color: #FF9900">独立访客: <span style="font-size: 20px"
                                                                              id="15_fk">0</span></span><br>
                    <span style="font-size: 14px; color: #6cbf3d">独立IP数: <span style="font-size: 20px"
                                                                               id="15_ip">0</span></span>
                </div>
            </div>
        </div>
        <div id="zb" style="float: left;width: 560px;height:320px"></div>
        <div style="float: left;width: 900px;height: 320px;" id="zxt">123123</div>
    </div>
    <div style="float: right;width: 40%;height:auto;">
        <style>
            .layer1:hover {
                background: #DCE8F1;
                cursor: pointer;
            }
        </style>
        <table id="all_list_num" style="width: 100%;display: none">
            <tr>
                <td id="em" style="white-space:normal">
                    总消费
                </td>
                <td id="emm" style="white-space:normal">
                    转化成本
                </td>
                <td id="emmm" style="white-space:normal">
                    转化数
                </td>
                <td id="emmmm" style="white-space:normal">点击均价</td>
            </tr>
            <tr>
                <td id="all_zxf"></td>
                <td id="all_zhcb"></td>
                <td id="all_zhs"></td>
                <td id="all_djjj"></td>
            </tr>
        </table>
        <table id="all_list" style="float: left;width: 100%;">


        </table>
    </div>
</div>
<div style="float: left;margin: 20px 1%;width: 98%" >
    <div style="text-align: center;height: 40px;line-height: 40px;font-size: 18px;margin-bottom: 10px;background: #2E91DA;color: white;display: none" id="ocpc">

    </div>
</div>

</body>

<script src="../js/jquery.min.js?v=2.1.4"></script>
<script src="../js/public.js"></script>
<script src="../js/bootstrap.min.js?v=3.3.6"></script>
<script src="../js/layer/layer.js"></script>
<script src="../js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
<script src="../js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="../js/demo/bootstrap-table-demo.min.js"></script>
<script src="../js/bootstrapValidator.js"></script>
<script src="../js/bootstrapValidator.min.js"></script>
<script src="../js/index.js"></script>
<script src="../js/plugins/simditor/module.js"></script>
<script src="../js/plugins/simditor/uploader.js"></script>
<script src="../js/plugins/simditor/hotkeys.js"></script>
<script src="../js/simditor-2.3.28/lib/simditor.js"></script>
<script src="../js/plugins/webuploader/webuploader.min.js"></script>
<script src="../js/echarts/dist/echarts.min.js"></script>

<!--<script src="../js/demo/webuploader-demo.min.js"></script>-->
<!--//下拉框js-->
<script src="../js/plugins/bootstrap-select-1.13.9/js/bootstrap-select.js"></script>

<script>
    let id = 0;
    let platform_id = 0;
    $(document).ready(function () {
        id = getUrlParam('bb_id');
        platform_id = getUrlParam('platform_id');
        getTj(id,platform_id);
    });

    //获取url中的参数
    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg);  //匹配目标参数
        if (r != null) return unescape(r[2]); return null; //返回参数值
    }
    var myChart = echarts.init(document.getElementById('zb'));
    var myChartzx = echarts.init(document.getElementById('zxt'));
    function getTj(page_id,platform_id = '0') {
        if('3' === platform_id){
            //uc的统计展示
            $('#all_list_num').show();
            requestData.data = {
                'page_id' : page_id
            };
            ajaxGo('admin/commodity/getCommodityStaticByUc');
            $('#title').text(requestData.data.title);
            $(document).attr('title',requestData.data.title  + ' - 筋斗云管理系统');
            layer.msg(requestMessage);
            $("#all_num").text(requestData.data.now_time); //一分钟内独立访客

            //今日最高
            $("#today_max").text(requestData.data.max_num.num);
            $("#today_max_time").text(requestData.data.max_num.time);

            //今日汇总
            $("#all_all").text(requestData.data.today.all);
            $("#all_fk").text(requestData.data.today.dl);
            $("#all_ip").text(requestData.data.today.ip);

            //15分钟
            $("#15_all").text(requestData.data.five.all);
            $("#15_fk").text(requestData.data.five.dl);
            $("#15_ip").text(requestData.data.five.ip);

            //总数
            $("#all_zxf").text(requestData.data.list_all.consume);
            $("#all_zhcb").text(requestData.data.list_all.bindingCpa);
            $("#all_zhs").text(requestData.data.list_all.bindingConversion);
            $("#all_djjj").text(requestData.data.list_all.acp);

            //占比
            var option = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b} : {c} ({d}%'
                },
                color:['#2E91DA','#f6bd0f','#F5AD46','#6CBF3D','#EDEB2C','#A149D9','#f6bd0f'],
                series: [
                    {
                        name: '访问来源',
                        type: 'pie',
                        radius: '35%',
                        center: ['50%', '55%'],
                        avoidLabelOverlap: true,
                        minAngle: 5,
                        label:{            //饼图图形上的文本标签
                            formatter: '{b|{b}：}{per|{d}%}\n{c|{c}}  ',
                            lineHeight: 13,
                            rich: {
                                a: {
                                    color: '#999',
                                    lineHeight: 22,
                                    align: 'center'
                                },
                                b: {
                                    fontSize: 11,
                                    lineHeight: 13,
                                    color: '#333',
                                },
                                per: {
                                    color: '#eee',
                                    backgroundColor: '#334455',
                                    padding: [2, 4],
                                    borderRadius: 2,
                                    fontSize: 9,
                                },
                                c: {
                                    align: 'left',
                                    fontSize: 10,
                                    color: '#999',
                                }

                            }
                        },
                        data: requestData.data.lnq_zb
                    }
                ]
            };
            myChart.setOption(option);

            //折线
            option = {
                legend: {
                    data: requestData.data.zxt
                },
                tooltip: {
                    trigger: 'axis'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                color:['#2E91DA','#F5AD46','#6CBF3D'],
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: ['00:00', '01:00', '02:00', '03:00', '04:00', '05:00', '06:00', '07:00', '08:00', '09:00', '10:00', '11:00', '12:00','13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '23:00']
                },
                yAxis: {
                    type: 'value'
                },
                series: requestData.data.llq_zb_zx
            };
            myChartzx.setOption(option);

            //右侧列表
            let html = '<tr style=" font-size:12px;font-weight:bold; line-height: 25px; background:#E9E9E9;">\n' +
                '                    <td style="text-align: right;  padding-left:2%; text-align:left;">素材id</td>\n' +
                '                    <td style="  text-align:center;">消费</td>\n' +
                '                    <td style=" text-align:center;">转化成本</td>\n' +
                '                    <td style="  text-align:center;">点击单价</td>\n' +
                '                    <td style=" text-align:center;">Chm占比</td>\n' +
                '                    <td style="  text-align:center;">uc占比</td>\n' +
                '                    <td style="  text-align:center;">转化数</td>\n' +
                '                    <td style="  text-align:center;">运行状态</td>\n' +
                '                    <td style="  text-align:center;">留存</td>\n' +
                '                </tr>';

            $('#all_list').empty();
            $('#all_list').append(html);
            requestData.data.list.forEach((item,index,array)=>{
                if(item.creativeState === '暂停'){
                    var html = '<tr class="layer1" style="width: 100%; line-height: 23px;">\n' +
                        '                    <td  onclick="getTjUCId('+item.creative_id+',this)" style="font-size:12px;text-align: right; color: #999; width: 70px; padding-left:2%; text-align:left;">'+item.creative_id+'</td>\n' +
                        '                    <td style=" font-size:10px;color: #2e91da;  text-align:center;">'+item.consume+'</td>\n' +
                        '                    <td style=" font-size:10px;color: #2e91da;  text-align:center;">'+item.bindingCpa+'</td>\n' +
                        '                    <td style=" font-size:10px;color: #2e91da;  text-align:center;">'+item.acp+'</td>\n' +
                        '                    <td style=" font-size:10px;color: #2e91da;  text-align:center;">'+item.zb+'%</td>\n' +
                        '                    <td style=" font-size:10px;color: #2e91da;  text-align:center;">'+item.uc_zb+'%</td>\n' +
                        '                    <td style=" font-size:10px;color: #2e91da;  text-align:center;">'+item.bindingConversion+'</td>\n' +
                        '                    <td onclick="onCreative(this)" data_creative_id = "'+item.creative_id+'" data_type = "1" style="color: #ee1e2d;  text-align:center;">'+item.creativeState+'</td>\n' +
                        '                    <td onclick="setInfoReserve(this)" data_creative_id = "'+item.creative_id+'" data_page_id = "'+page_id+'" style="  text-align:center;">'+item.is_reserve+'</td>\n' +
                        '                </tr>'//执行代码
                }else if(item.creativeState === '审核中'){
                    var html = '<tr class="layer1" style="width: 100%; line-height: 23px;">\n' +
                        '                    <td  onclick="getTjUCId('+item.creative_id+',this)" style="font-size:12px;text-align: right; color: #999; width: 70px; padding-left:2%; text-align:left;">'+item.creative_id+'</td>\n' +
                        '                    <td style="font-size:10px;color: #2e91da;  text-align:center;">'+item.consume+'</td>\n' +
                        '                    <td style="font-size:10px;color: #2e91da;  text-align:center;">'+item.bindingCpa+'</td>\n' +
                        '                    <td style="font-size:10px;color: #2e91da;  text-align:center;">'+item.acp+'</td>\n' +
                        '                    <td style="font-size:10px; color: #2e91da;  text-align:center;">'+item.zb+'%</td>\n' +
                        '                    <td style=" font-size:10px;color: #2e91da;  text-align:center;">'+item.uc_zb+'%</td>\n' +
                        '                    <td style=" font-size:10px;color: #2e91da;  text-align:center;">'+item.bindingConversion+'</td>\n' +
                        '                    <td style="font-size:10px; color: orange;  text-align:center;">'+item.creativeState+'</td>\n' +
                        '                    <td onclick="setInfoReserve(this)" data_creative_id = "'+item.creative_id+'" data_page_id = "'+page_id+'" style="  text-align:center;">'+item.is_reserve+'</td>\n' +
                        '                </tr>'//执行代码
                }
                else {
                    var html = '<tr class="layer1" style="width: 100%; line-height: 23px;">\n' +
                        '                    <td onclick="getTjUCId('+item.creative_id+',this)" style="font-size:12px;text-align: right; color: #999; width: 70px; padding-left:2%; text-align:left;">'+item.creative_id+'</td>\n' +
                        '                    <td style="font-size:10px;color: #2e91da;  text-align:center;">'+item.consume+'</td>\n' +
                        '                    <td style="font-size:10px;color: #2e91da;  text-align:center;">'+item.bindingCpa+'</td>\n' +
                        '                    <td style="font-size:10px;color: #2e91da;  text-align:center;">'+item.acp+'</td>\n' +
                        '                    <td style=" font-size:10px;color: #2e91da;  text-align:center;">'+item.zb+'%</td>\n' +
                        '                    <td style=" font-size:10px;color: #2e91da;  text-align:center;">'+item.uc_zb+'%</td>\n' +
                        '                    <td style=" font-size:10px;color: #2e91da;  text-align:center;">'+item.bindingConversion+'</td>\n' +
                        '                    <td onclick="onCreative(this)" data_creative_id = "'+item.creative_id+'" data_type = "0" style=" color: green;  text-align:center;">'+item.creativeState+'</td>\n' +
                        '                    <td onclick="setInfoReserve(this)" data_creative_id = "'+item.creative_id+'" data_page_id = "'+page_id+'" style="  text-align:center;">'+item.is_reserve+'</td>\n' +
                        '                </tr>'//执行代码
                }

                $('#all_list').append(html);
            });

            layer.msg('加载成功');
        }
        else {
            $('#all_list_num').hide();

            requestData.data = {
                'page_id' : page_id
            };
            ajaxGo('admin/commodity/getCommodityStatic');

            //ocpc
            if(requestData.data.ocpc.length > 0){
                $('#ocpc').show();
                let i = 1;
                requestData.data.ocpc.forEach((item,index,array)=>{
                    //执行代码
                    let html = ' <span style="margin-right: 0.5%;">\n' +
                        '            '+ i*10 +'秒：'+item+'\n' +
                        '        </span>';
                    $('#ocpc').append(html);
                    i++;
                });
            }
            console.log(requestData.data.ocpc.length);

            $('#title').text(requestData.data.title);
            $(document).attr('title',requestData.data.title + ' - 筋斗云管理系统');

            $("#all_num").text(requestData.data.now_time); //一分钟内独立访客

            //今日最高
            $("#today_max").text(requestData.data.max_num.num);
            $("#today_max_time").text(requestData.data.max_num.time);

            //今日汇总
            $("#all_all").text(requestData.data.today.all);
            $("#all_fk").text(requestData.data.today.dl);
            $("#all_ip").text(requestData.data.today.ip);

            //15分钟
            $("#15_all").text(requestData.data.five.all);
            $("#15_fk").text(requestData.data.five.dl);
            $("#15_ip").text(requestData.data.five.ip);

            //来源总数
            let all_num = requestData.data.all_urls.all;

            //占比
            var option = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b} : {c} ({d}%'
                },
                color:['#2E91DA','#f6bd0f','#F5AD46','#6CBF3D','#EDEB2C','#A149D9','#f6bd0f'],
                series: [
                    {
                        name: '访问来源',
                        type: 'pie',
                        radius: '35%',
                        center: ['50%', '45%'],
                        avoidLabelOverlap: true,
                        minAngle: 5,
                        label:{            //饼图图形上的文本标签
                            formatter: '{b|{b}：}{per|{d}%}\n{c|{c}}  ',
                            lineHeight: 13,
                            rich: {
                                a: {
                                    color: '#999',
                                    lineHeight: 22,
                                    align: 'center'
                                },
                                b: {
                                    fontSize: 11,
                                    lineHeight: 13,
                                    color: '#333',
                                },
                                per: {
                                    color: '#eee',
                                    backgroundColor: '#334455',
                                    padding: [2, 4],
                                    borderRadius: 2,
                                    fontSize: 9,
                                },
                                c: {
                                    align: 'left',
                                    fontSize: 10,
                                    color: '#999',
                                }

                            }
                        },
                        data: [
                            {value: requestData.data.bt[0]['num'], name: requestData.data.bt[0]['url']},
                            {value: requestData.data.bt[1]['num'], name: requestData.data.bt[1]['url']},
                            {value: requestData.data.bt[2]['num'], name: requestData.data.bt[2]['url']},
                            {value: requestData.data.bt[3]['num'], name: requestData.data.bt[3]['url']},
                            {value: requestData.data.bt[4]['num'], name: requestData.data.bt[4]['url']},
                            {value: requestData.data.bt[5]['num'], name: requestData.data.bt[5]['url']},
                            {value: requestData.data.bt[6]['num'], name: requestData.data.bt[6]['url']},
                        ]
                        // ,
                        // emphasis: {
                        //     itemStyle: {
                        //         shadowBlur: 10,
                        //         shadowOffsetX: 0,
                        //         shadowColor: 'rgba(0, 0, 0, 0.5)'
                        //     }
                        // }
                    }
                ]
            };
            myChart.setOption(option);

            option = {
                legend: {
                    data: [requestData.data.zxt[0]['url'], requestData.data.zxt[1]['url'], requestData.data.zxt[2]['url']]
                },
                tooltip: {
                    trigger: 'axis'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                color:['#2E91DA','#F5AD46','#6CBF3D'],
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: ['00:00', '01:00', '02:00', '03:00', '04:00', '05:00', '06:00', '07:00', '08:00', '09:00', '10:00', '11:00', '12:00','13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '23:00']
                },
                yAxis: {
                    type: 'value'
                },
                series: [
                    {
                        name: requestData.data.zxt[0]['url'],
                        type: 'line',
                        stack: '总量1',
                        data: requestData.data.zxt[0]['data']
                    },
                    {
                        name: requestData.data.zxt[1]['url'],
                        type: 'line',
                        stack: '总量2',
                        data: requestData.data.zxt[1]['data']
                    },
                    {
                        name: requestData.data.zxt[2]['url'],
                        type: 'line',
                        stack: '总量3',
                        data: requestData.data.zxt[2]['data']
                    }
                ]
            };


            myChartzx.setOption(option);

            //右侧列表
            let html = '<tr style=" font-size:12px;font-weight:bold; width: 100%; line-height: 25px; background:#E9E9E9;">\n' +
                '                    <td style="text-align: right; width: 35%; padding-left:2%; text-align:left;">来路域名</td>\n' +
                '                    <td style="text-align: left; width: 25%; text-align:left;">次数</td>\n' +
                '                    <td style="text-align: right;  text-align:left;">占比</td>\n' +
                '                </tr>';

            $('#all_list').empty();
            $('#all_list').append(html);
            requestData.data.all_urls.list.forEach((item,index,array)=>{
                if(item.url === ''){
                    item.url = '未知来源';
                }
                var html = '<tr class="layer1" style="font-size:12px;width: 100%; line-height: 23px;">\n' +
                    '                    <td style="text-align: right; color: #999; width: 100px; padding-left:2%; text-align:left;">'+item.url+'</td>\n' +
                    '                    <td style="text-align: left; color: #999; width: 25%; text-align:left;">'+item.count+'</td>\n' +
                    '                    <td style="text-align: right; color: #2e91da;  text-align:left;">'+((item.count/all_num)*100).toFixed(2)+'%</td>\n' +
                    '                </tr>'//执行代码
                $('#all_list').append(html);
            });

            layer.msg('加载成功');
        }
    }

</script>
</html>